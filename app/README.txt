./.venv/Scripts/activate
uvicorn app.main:app --reload
http://127.0.0.1:8000/docs

ã“ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é–‰ã˜ã¦æ¬¡ã®æ–°ã—ã„ã‚¹ãƒ¬ãƒƒãƒ‰ã«å¼•ãç¶™ã”ã†ã€‚ã„ã¤ã‚‚ã©ãŠã‚Šã§ãã‚‹ã ã‘è©³ã—ãé–‹ç™ºçŠ¶æ³ã‚’æ¬¡ã®GPTã«èª¬æ˜ã—ã¦ã‚¹ãƒ ãƒ¼ã‚ºã«å§‹ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ã«å¼•ãç¶™ãæ–‡ã‚’ä½œã£ã¦ã€‚


ğŸ“‘ å¼•ãç¶™ããƒ¡ãƒ¢ï¼šç±³ç›´å£²ï¼ å¾³å³¶ LINEãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆWebã‚¢ãƒ—ãƒªé–‹ç™ºï¼‰

âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ç›®çš„ï¼šå¾³å³¶å¸‚å‘¨è¾ºã®æ¶ˆè²»è€…ã¨ç±³è¾²å®¶ã‚’ã¤ãªãã€ŒLINEï¼‹äºˆç´„Webã‚¢ãƒ—ãƒªã€ç›´å£²ã‚·ã‚¹ãƒ†ãƒ 

ãƒ“ã‚¸ãƒ§ãƒ³ï¼šè¾²å®¶ãŒè‡ªèµ°ã§ãã€æ¶ˆè²»è€…ã¯LINEã ã‘ã§ç°¡å˜ã«äºˆç´„ã§ãã‚‹UX

ãƒãƒã‚¿ã‚¤ã‚ºï¼šè¾²å®¶ã‹ã‚‰ã®æœˆé¡ã‚µãƒ–ã‚¹ã‚¯èª²é‡‘ï¼ˆ3ã‹æœˆç„¡æ–™ â†’ æœˆé¡1,200å††ï¼‰

âœ… ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆï¼ˆãƒ•ã‚§ãƒ¼ã‚º2ä»¥é™ï¼‰

LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆå…±é€šï¼‰

æ¶ˆè²»è€…ã¨ã®å…¥å£ãƒ»é€šçŸ¥

äºˆç´„ãƒœã‚¿ãƒ³ï¼ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ Webã‚¢ãƒ—ãƒªã¸èª˜å°

è‡ªä½œWebã‚¢ãƒ—ãƒªï¼ˆFastAPIï¼‰

è¾²å®¶ï¼šä¾¡æ ¼ãƒ»å—ã‘æ¸¡ã—æ¡ä»¶ãƒ»åœ¨åº«ã‚’ç™»éŒ²ï¼ç·¨é›†

æ¶ˆè²»è€…ï¼šéƒµä¾¿ç•ªå·æ¤œç´¢ã§è¾²å®¶é¸æŠ â†’ äºˆç´„å…¥åŠ›ï¼ˆãƒªãƒ”ãƒ¼ãƒˆã¯ç›´è¡Œï¼‰

DBç®¡ç†ï¼ˆUsers, Farms, Reservationsï¼‰

LINE Messaging API

äºˆç´„ç¢ºå®šæ™‚ã«æ¶ˆè²»è€…ã¸ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

âœ… UXè¦ä»¶
æ¶ˆè²»è€…

åˆå›ï¼šéƒµä¾¿ç•ªå·æ¤œç´¢ â†’ è¾²å®¶é¸æŠ â†’ äºˆç´„

ãƒªãƒ”ãƒ¼ãƒˆï¼šå‰å›è¾²å®¶ã«ç›´è¡Œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å†æ¤œç´¢å¯ï¼‰

é€šçŸ¥ï¼šäºˆç´„ç¢ºèªã®ã¿ï¼ˆãƒ¡ãƒ«ãƒã‚¬é…ä¿¡ã¯ã—ãªã„ï¼‰

è¾²å®¶

Webç®¡ç†ç”»é¢ã‹ã‚‰ä¾¡æ ¼ãƒ»è²©å£²æ¡ä»¶ã‚’è¨­å®šå¯èƒ½

åœ¨åº«åˆ‡ã‚Œæ™‚ã¯å³åœæ­¢

è§£ç´„æ™‚ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç„¡åŠ¹åŒ– â†’ æ¶ˆè²»è€…äºˆç´„ä¸å¯

âœ… æ‹¡å¼µæ©Ÿèƒ½ï¼ˆä»Šå¾Œï¼‰

ãŠæ°—ã«å…¥ã‚Šè¾²å®¶ä¿å­˜

QRã‚³ãƒ¼ãƒ‰ï¼‹ãƒãƒ©ã‚·è‡ªå‹•ç”Ÿæˆ

Stripeã‚µãƒ–ã‚¹ã‚¯èª²é‡‘ï¼ˆè¾²å®¶ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ç´ä»˜ã‘ï¼‰

âœ… æŠ€è¡“ä»•æ§˜

ã‚¹ã‚¿ãƒƒã‚¯ï¼šFastAPI + SQLiteï¼ˆâ†’å°†æ¥PostgreSQLï¼‰

é–‹ç™ºæ–¹é‡ï¼šSQLiteã§ãƒ†ã‚¹ãƒˆ â†’ æœ¬ç•ªPostgreSQL

é †åºï¼šAPIé–‹ç™º â†’ LINEé€£æº â†’ ãƒ•ãƒ­ãƒ³ãƒˆUI

ğŸ”° å¼•ãç¶™ããƒ¡ãƒ¢ï¼šç±³ç›´å£²ï¼ å¾³å³¶ã€ŒLINEï¼‹äºˆç´„Webã‚¢ãƒ—ãƒªã€ï¼ˆLINEé€šçŸ¥å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºï¼‰
ğŸ¯ ç¾åœ¨ã®é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

FastAPI + SQLiteï¼ˆå°†æ¥PostgreSQLï¼‰ã«ã‚ˆã‚‹ç›´å£²äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ä¸­ã€‚
ç¾åœ¨ã¯ LINEé€šçŸ¥ï¼ˆDRY_RUNãƒ¢ãƒ¼ãƒ‰ï¼‰é€£æºã®ãƒ†ã‚¹ãƒˆæ®µéšã€‚

âœ… ã“ã‚Œã¾ã§ã®æˆæœ

line_notifier.py å®Ÿè£…æ¸ˆã¿ï¼ˆDRY_RUNï¼1ã§ãƒ­ã‚°ç¢ºèªOKï¼‰

services/__init__.py ä½œæˆæ¸ˆã¿

env.py æ­£å¸¸å‹•ä½œï¼ˆAlembic ãŒ .env ã® DATABASE_URL ã‚’èª­ã‚ã‚‹ï¼‰

Alembicãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ

INFO  [alembic.runtime.migration] Running upgrade -> de76fc19b371, add line_user_id to users


models.py ã« line_user_id ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ï¼ˆnullable, index=Trueï¼‰

schemas.py ã« line_user_id ã‚’è¿½åŠ æ¸ˆã¿ï¼ˆUserCreate, UserResponseä¸¡æ–¹ï¼‰

crud.py æ”¹ä¿®æ¸ˆã¿ â†’ model_dump(exclude_none=True) ã«ã‚ˆã‚Š line_user_id ã‚’ä¿å­˜å¯èƒ½

GET /users/ ã§ "line_user_id": "U_TEST_12345" ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªæ¸ˆã¿

DRY_RUN ãƒ­ã‚°ã§é€šçŸ¥å…ˆ U_TEST_12345 ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚‚ç¢ºèªæ¸ˆã¿

ğŸ§© ç¾åœ¨ã®ã‚¢ãƒ—ãƒªæ§‹æˆ
rice-app/
â””â”€â”€ app/
    â”œâ”€â”€ main.py
    â”œâ”€â”€ database.py
    â”œâ”€â”€ models.py           # âœ… line_user_idã‚«ãƒ©ãƒ ã‚ã‚Š
    â”œâ”€â”€ schemas.py          # âœ… UserCreate/UserResponseã«line_user_idã‚ã‚Š
    â”œâ”€â”€ crud.py             # âœ… model_dump(exclude_none=True)
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ line_notifier.py  # âœ… DRY_RUNå‹•ä½œOK
    â””â”€â”€ routers/
        â”œâ”€â”€ users.py        # âœ… UserCreateå—ã‘å–ã‚Šï¼‹UserResponseè¿”å´
        â”œâ”€â”€ farms.py
        â””â”€â”€ reservations.py # âœ… status=confirmedæ™‚ã«LINEé€šçŸ¥å‘¼ã³å‡ºã—

âš™ï¸ ç¾åœ¨ã® .env è¨­å®šï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
DATABASE_URL=sqlite:///./app.db
LINE_NOTIFY_DRY_RUN=1
LINE_CHANNEL_ACCESS_TOKEN=ï¼ˆæœªè¨­å®šï¼‰

ğŸ“‹ æ¬¡ã®ã‚¿ã‚¹ã‚¯å€™è£œ

LINE_NOTIFY_DRY_RUN=0 ã«åˆ‡ã‚Šæ›¿ãˆã¦ å®Ÿé€ä¿¡ãƒ†ã‚¹ãƒˆ

.env ã« LINE_CHANNEL_ACCESS_TOKEN ã‚’è¨­å®š

LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®Messaging APIè¨­å®šï¼ˆã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œãƒ»pushæ¨©é™ç¢ºèªï¼‰

PUT /users/{user_id}/line_id APIï¼ˆæ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®line_user_idç™»éŒ²ï¼‰è¿½åŠ 

price_20kg â†’ price_25kg ãƒªãƒãƒ¼ãƒ ï¼ˆAlembicå†ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

active_flag ã‚’äºˆç´„æ™‚ãƒã‚§ãƒƒã‚¯ã«çµ„ã¿è¾¼ã¿ï¼ˆfalseãªã‚‰äºˆç´„ä¸å¯ï¼‰

ğŸ’¬ ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆçµæœã¾ã¨ã‚

âœ… line_user_idä¿å­˜ãƒ»è¡¨ç¤ºOK

âœ… Alembicã«ã‚ˆã‚‹DBã‚¹ã‚­ãƒ¼ãƒæ›´æ–°æˆåŠŸ

âœ… DRY_RUNãƒ­ã‚°å‡ºåŠ›OKï¼ˆäºˆç´„ç¢ºå®šæ™‚ï¼‰

ğŸš§ LINEå®Ÿé€ä¿¡ã¯æœªç¢ºèªï¼ˆã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³æœªè¨­å®šï¼‰

ã“ã®ã‚¹ãƒ¬ã§ã¯ã€ŒLINEé€šçŸ¥ã€ã¾ã§ã®å®Ÿè£…ç¢ºèªãŒå®Œäº†ã€‚
æ¬¡ã‚¹ãƒ¬ã§ã¯ä»¥ä¸‹ã„ãšã‚Œã‹ã‚’ç¶™ç¶šï¼š

å®Ÿéš›ã®LINE pushé€ä¿¡ãƒ†ã‚¹ãƒˆã¸é€²ã‚€

æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«line_user_idã‚’ä»˜ä¸ã™ã‚‹PUT APIå®Ÿè£…

price_25kgãƒªãƒãƒ¼ãƒ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæ¥­
Public ãƒšãƒ¼ã‚¸ç”¨ DTOï¼ˆOpenAPI Generatedï¼‰ã®è¨­è¨ˆæ–‡æ›¸
1. ç›®çš„ï¼ˆWhyï¼‰

Public ãƒšãƒ¼ã‚¸ï¼ˆFarmsList / Map / FarmDetail / Confirm ãªã©ï¼‰ã§ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® DTOï¼ˆOpenAPIï¼‰ã¨å¸¸ã«ä¸€è‡´ã•ã›ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚

ã“ã‚Œã«ã‚ˆã‚Šï¼š

ãƒ•ãƒ­ãƒ³ãƒˆã§ DTO ã‚’æ‰‹æ›¸ãã—ãªã„

å‹ã‚ºãƒ¬ãƒ»å–ã‚Šã“ã¼ã—ãƒ»è§£é‡ˆé•ã„ã‚’æ§‹é€ çš„ã«é˜²ã

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å¤‰æ›´ã‚’ build æ™‚ã«æ¤œçŸ¥ã§ãã‚‹

2. Single Source of Truth
åŸå‰‡

Public ãƒšãƒ¼ã‚¸ã® DTO ã®å”¯ä¸€ã®æ­£ã¯ã€
FastAPI ãŒå‡ºåŠ›ã™ã‚‹ /openapi.json ã§ã‚ã‚‹

ãƒ•ãƒ­ãƒ³ãƒˆå´ã§ DTO ã‚’å®šç¾©ã—ãªã„

types.ts / interfaces.ts çš„ãªæ‰‹ä½œæ¥­å®šç¾©ã¯ç¦æ­¢

OpenAPI ã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸå‹ã®ã¿ã‚’ä½¿ç”¨ã™ã‚‹

3. DTO ã®ç”Ÿæˆå…ƒ
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

FastAPI

Pydantic Model â†’ OpenAPI Schema

ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¾‹ï¼š

/api/public/farms

/api/public/farms/map

/api/public/farms/{id}

ã“ã‚Œã‚‰ãŒ Public ãƒšãƒ¼ã‚¸ç”¨ DTO ã®èµ·ç‚¹ã¨ãªã‚‹ã€‚

4. ãƒ•ãƒ­ãƒ³ãƒˆå´ã®ç”Ÿæˆç‰©
ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«
frontend/
â””â”€ src/
   â””â”€ api/
      â””â”€ generated/
         â””â”€ public-farms.ts

ç”Ÿæˆãƒ„ãƒ¼ãƒ«

openapi-typescript

OpenAPI JSON ã‹ã‚‰ å‹ã®ã¿ã‚’ç”Ÿæˆ

å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ï¼š

npm run gen:public-farms

5. public-farms.ts ã®ä¸­èº«ï¼ˆå½¹å‰²ï¼‰

public-farms.ts ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã‚‹ï¼š

Public API ã® Request / Response å‹

è¾²å®¶ä¸€è¦§ãƒ»ãƒãƒƒãƒ—ãƒ»è©³ç´°ã§ä½¿ã† DTO

ä¾‹ï¼ˆæ¦‚å¿µï¼‰ï¼š

export interface PublicFarm {
  farm_id: number;
  owner_label: string;
  price_10kg: number;
  pr_images: string[];
  owner_address_label: string;
  next_pickup_display: string;
  lat: number | null;
  lng: number | null;
}


â€» å®Ÿéš›ã®å‹åãƒ»æ§‹é€ ã¯ OpenAPI å®šç¾©ã«å®Œå…¨ä¾å­˜ã™ã‚‹ã€‚

6. ãƒ•ãƒ­ãƒ³ãƒˆã§ã®ä½¿ç”¨ãƒ«ãƒ¼ãƒ«ï¼ˆé‡è¦ï¼‰
ä½¿ç”¨ OK
import { components } from "@/api/generated/public-farms";

type PublicFarm =
  components["schemas"]["PublicFarm"];


generated å‹ã‚’ãã®ã¾ã¾ä½¿ã†

ã‚‚ã—ãã¯ Pick<> / Omit<> ã«ã‚ˆã‚‹æ´¾ç”Ÿã®ã¿è¨±å¯

ä½¿ç”¨ NG
type FarmCardData = {
  id: number;
  price: number;
  ...
};


ç†ç”±ï¼š

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ä¹–é›¢ã™ã‚‹

ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ãƒ»å‰Šé™¤ã‚’æ¤œçŸ¥ã§ããªã„

å°†æ¥ã®ä¸æ•´åˆã®æ¸©åºŠ

7. UI ç”¨ã®å†…éƒ¨å¤‰æ›ã«ã¤ã„ã¦
è¨±å¯ã•ã‚Œã‚‹ã®ã¯ã€Œæ§‹é€ å¤‰æ›ã€ã§ã¯ãªãã€Œè¡¨ç¤ºå¤‰æ›ã€

OKï¼š

const priceLabel = `Â¥${farm.price_10kg.toLocaleString()}ï¼ˆ10kgï¼‰`;


NGï¼š

const farmCard: FarmCardData = {
  id: farm.farm_id,
  price10kg: farm.price_10kg,
  ...
};


ğŸ‘‰ DTO â†’ DTO ã®å†å®šç¾©ã¯ç¦æ­¢
ğŸ‘‰ DTO â†’ è¡¨ç¤ºç”¨å€¤ã®è¨ˆç®—ã¯ OK

8. åŒæœŸã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨é‹ç”¨
é–‹ç™ºæ™‚ï¼ˆdevï¼‰

DTO è‡ªå‹•åŒæœŸã¯ å¸¸æ™‚ã§ã¯è¡Œã‚ãªã„

å¿…è¦ãªã¨ãã«æ˜ç¤ºçš„ã«å®Ÿè¡Œï¼š

npm run gen:public-farms:dev


ç†ç”±ï¼š

dev èµ·å‹•ã‚’å£Šã•ãªã„

OpenAPI å–å¾—å¤±æ•—ã§ãƒ•ãƒ­ãƒ³ãƒˆãŒæ­¢ã¾ã‚‹ã®ã‚’é˜²ã

æœ¬ç•ª / CI / Vercel
npm run build


prebuild ã§ å¿…ãš DTO å†ç”Ÿæˆ

OpenAPI ã¨ã‚ºãƒ¬ã¦ã„ãŸã‚‰ build å¤±æ•—

ã‚ºãƒ¬ãŸ DTO ãŒæœ¬ç•ªã«å‡ºã‚‹ã“ã¨ã¯ãªã„

9. public-farms.ts ã‚’ git ç®¡ç†ã™ã‚‹ç†ç”±

DTO ã®å¤‰æ›´å·®åˆ†ãŒ PR ã§å¯è¦–åŒ–ã•ã‚Œã‚‹

backend ã®ç ´å£Šçš„å¤‰æ›´ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼æ®µéšã§æ¤œçŸ¥ã§ãã‚‹

backend ãŒè½ã¡ã¦ã„ã¦ã‚‚ãƒ•ãƒ­ãƒ³ãƒˆé–‹ç™ºãŒå¯èƒ½

ğŸ‘‰ ç”Ÿæˆç‰©ã ãŒã€ã‚ãˆã¦ commit ã™ã‚‹

10. ã“ã®è¨­è¨ˆã§é˜²ã’ã‚‹äº‹æ•…

ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®é£Ÿã„é•ã„

nullable ã®æ‰±ã„ãƒŸã‚¹

backend å´ã§ã®ä»•æ§˜å¤‰æ›´ã®è¦‹è½ã¨ã—

ã€Œãªãœã“ã“ undefinedï¼Ÿã€å•é¡Œ

11. è¨­è¨ˆæ€æƒ³ã¾ã¨ã‚ï¼ˆçŸ­æ–‡ï¼‰

DTO ã¯ å®šç¾©ã—ãªã„ã€ç”Ÿæˆã™ã‚‹

ãƒ•ãƒ­ãƒ³ãƒˆã¯ è§£é‡ˆã—ãªã„ã€ä½¿ã†

ã‚ºãƒ¬ã¯ build ã§æ­¢ã‚ã‚‹

dev ä½“é¨“ã¯ å£Šã•ãªã„

12. å°†æ¥æ‹¡å¼µ

Public ä»¥å¤–ï¼ˆAdmin / Farmerï¼‰ã‚‚åŒæ§˜ã«

admin-*.ts

farmer-*.ts

API å¢ƒç•Œã”ã¨ã« generated DTO ã‚’åˆ†é›¢